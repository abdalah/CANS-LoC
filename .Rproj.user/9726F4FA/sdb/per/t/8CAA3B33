{
    "collab_server" : "",
    "contents" : "load(\"updated.RData\")\n\ncomplete$county <- lapply(strsplit(as.character(complete$AGENCY_NAME), \"\\\\County\"), \"[\", 1)\n\ncomplete$county <- unlist(complete$county)\n\nlibrary(magrittr)\nlibrary(dplyr)\nlibrary(lubridate)\n#you have to create a new dataframe (or rewrite your existing one)\ncomplete <- complete %>%\n  group_by(CHILD_ID) %>%\n  mutate(number_placements = length(unique(END_DATE)))\n\n\n# library(ggplot2)\n# library(plyr)\n# library(lubridate)\n# complete3$LengthOfStay <- as.numeric(as.Date(complete3$END_DATE)-as.Date(complete3$BEGIN_DATE), units=\"days\")\n# ggplot(complete3, aes(x=lengthofstay)) + geom_histogram(binwidth=7)\n# \n# complete$IntakeAge <- NULL\n# complete$DischargeAge <- NULL\n# \n# complete3$IntakeYears <- new_interval(complete3$BIRTH_DATE, complete3$BEGIN_DATE) / duration(num = 1, units = \"years\")\n# complete3$IntakeMonths <- new_interval(complete3$BIRTH_DATE, complete3$BEGIN_DATE) / duration(num = 1, units = \"months\")\n# complete3$IntakeDays <- new_interval(complete3$BIRTH_DATE, complete3$BEGIN_DATE) / duration(num = 1, units = \"days\")\n# \n# age.labels <- c(\"0-4 years old\", \"5-7 years old\", \"8-11 years old\", \"12-14 years old\", \"15-17 years old\", \"18+ years old\")\n# complete3$IntakeAgeGroup <- cut(complete3$IntakeYears, breaks = c(0, 5, 8, 12, 15, 18, 100), labels = age.labels, include.lowest = TRUE)\n# \n# complete3$LengthOfStay <- new_interval(complete3$BEGIN_DATE, complete3$END_DATE) / duration(num = 1, units = \"months\")\n# los.labels <- c(\"Under 1 month\", \"1 to 2 months\", \"3 to 6 months\", \"7 to 11 months\", \"1 to 2 years\", \"2+ years\")\n# complete3$losMonths <- cut(complete3$LengthOfStay, breaks = c(0, 1,  3,  7, 12, 24, 100), labels = los.labels, include.lowest = FALSE)\n# \n# ggplot(complete3, aes(x=IntakeAgeGroup)) + geom_bar()\n# ggplot(complete3, aes(x=losMonths)) + geom_bar()\n# ggplot(complete3, aes(x=IntakeYears)) + geom_histogram(binwidth=1)\n\n\n#####\nlibrary(dplyr)\nlibrary(magrittr)\nlibrary(data.table)\n\n# complete$AGENCY_ID <- factor(complete$AGENCY_ID)\n# complete$CHILD_ID <- factor(complete$CHILD_ID)\n# \n# complete <- complete %>% group_by(AGENCY_ID) %>%\n#   mutate(KidsInAgency=n_distinct(CHILD_ID))\n# \n# complete$KidsInAgency2 <- complete$`as.factor(AGENCY_ID)` <- complete$White <- NULL\n# \n# complete$White <- 0\n# complete$White[complete$race==\"White\"] <- 1\n\n# complete <- complete %>% group_by(county) %>%\n#   mutate(AgencyWhite=sum(unqiue(White)))\n\n# ggplot(complete, aes(x=KidsInAgency)) + geom_histogram()\n# ggplot(complete, aes(x=AgencyWhiteWhite, y=county)) + geom_histogram()\n\nsave(complete, df.5, file=\"updated.RData\")\nload(\"updated.RData\")\n\nnew<-subset(complete, !duplicated(CHILD_ID) & race==\"White\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(White=length(unique(CHILD_ID)))\nnew <- subset(new, !duplicated(AGENCY_ID))\nnew$MinorityPercent <- 1-new$White/new$KidsInAgency\nmerger <- cbind.data.frame(new$AGENCY_ID, new$MinorityPercent)\ncolnames(merger) <- c(\"AGENCY_ID\", \"MinorityPercent\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x = T)\n\nnew<-subset(complete, !duplicated(CHILD_ID) & GENDER_CODE==\"FEMALE\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(Female=length(unique(CHILD_ID)))\nnew <- subset(new, !duplicated(AGENCY_ID))\nnew$AgencyFemalePercent <- new$Female/new$KidsInAgency\nmerger <- cbind.data.frame(new$AGENCY_ID, new$AgencyFemalePercent)\ncolnames(merger) <- c(\"AGENCY_ID\", \"AgencyFemalePercent\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x = T)\n\n\ncomplete$pilot <- 0\ncomplete$pilot[complete$county==\"Athens \"] <- 1\ncomplete$pilot[complete$county==\"Clark \"] <- 1\ncomplete$pilot[complete$county==\"Franklin \"] <- 1\ncomplete$pilot[complete$county==\"Greene \"] <- 1\ncomplete$pilot[complete$county==\"Guernsey \"] <- 1\ncomplete$pilot[complete$county==\"Knox \"] <- 1\ncomplete$pilot[complete$county==\"Madison \"] <- 1\ncomplete$pilot[complete$county==\"Montgomery \"] <- 1\ncomplete$pilot[complete$county==\"Morrow \"] <- 1\ncomplete$pilot[complete$county==\"Stark \"] <- 1\ncomplete$pilot[complete$county==\"Summit \"] <- 1\n\n\nnew<-subset(complete, !duplicated(CHILD_ID),)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(AgencyAverageAge=mean(IntakeYears, na.rm=T))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$AgencyAverageAge)\ncolnames(merger) <- c(\"AGENCY_ID\", \"AgencyAverageAge\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x = T)\n\nnew<-subset(complete, !duplicated(CHILD_ID),)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(AgencyAverageLOS=mean(LengthOfStay, na.rm=T))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$AgencyAverageLOS)\ncolnames(merger) <- c(\"AGENCY_ID\", \"AgencyAverageLOS\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x = T)\n\n## Average Number of Placements, Placement Types, Remove Service Authorization\n\nsave(complete, df.5, file=\"updated.RData\")\n\n########################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################\n\nrm(list = ls())\nload(\"updated.RData\")\n\ncomplete$SERVICE_AUTH_ID <-  complete$BASIC_COST <-  complete$COST_TYPE_CODE <-  complete$SERVICE_BEGIN_DATE <-  complete$SERVICE_END_DATE <-  complete$SERVICE_RATE_ID <-  complete$EFFECTIVE_DATE <-  complete$UNIT_OF_MEASURE <-  complete$STANDARD_COST <-  complete$CONTRACT_ID <-  complete$CONTRACT_COST_ID <-  complete$PERSON_ID <-  complete$COST_BEGIN_DATE <-  complete$COST_END_DATE <-  complete$UNIT_COST <-  complete$MAINTENANCE_COST <-  complete$ADMIN_COST <-  complete$PROVIDER_SERVICE_ID <- complete$EFFECTIVE_DATE.y <- complete$LEGAL_STATUS_INFO_ID.y <- NULL\n\nnew<-subset(complete, PlacementType==\"Certified Children's Residential Center\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(ResidentialCenter=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$ResidentialCenter)\ncolnames(merger) <- c(\"AGENCY_ID\", \"ResidentialCenter\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Certified Foster Home\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(FosterHome=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$FosterHome)\ncolnames(merger) <- c(\"AGENCY_ID\", \"FosterHome\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Certified Approved Non-Relative\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(NonRelative=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$NonRelative)\ncolnames(merger) <- c(\"AGENCY_ID\", \"NonRelative\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\n\nnew<-subset(complete, PlacementType==\"Certified Group Home\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(GroupHome=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$GroupHome)\ncolnames(merger) <- c(\"AGENCY_ID\", \"GroupHome\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Certified/Approved Relative Care\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(RelativeCare=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$RelativeCare)\ncolnames(merger) <- c(\"AGENCY_ID\", \"RelativeCare\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\n\nnew<-subset(complete, PlacementType==\"Detention Facility\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(DetentionFacility=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$DetentionFacility)\ncolnames(merger) <- c(\"AGENCY_ID\", \"DetentionFacility\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\n\nnew<-subset(complete, PlacementType==\"LICENSEDMEF\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(LICENSEDMEF=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$LICENSEDMEF)\ncolnames(merger) <- c(\"AGENCY_ID\", \"LICENSEDMEF\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Adoptive Placement\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(AdoptivePlacement=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$AdoptivePlacement)\ncolnames(merger) <- c(\"AGENCY_ID\", \"AdoptivePlacement\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Certified Emergency Shelter Care Facility\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(EmergencyShelter=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$EmergencyShelter)\ncolnames(merger) <- c(\"AGENCY_ID\", \"EmergencyShelter\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Independent Living\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(IndependentLiving=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$IndependentLiving)\ncolnames(merger) <- c(\"AGENCY_ID\", \"IndependentLiving\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Own Home\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(OwnHome=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$OwnHome)\ncolnames(merger) <- c(\"AGENCY_ID\", \"OwnHome\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\nnew<-subset(complete, PlacementType==\"Residential Parenting Facility\",)\nnew <- new %>% group_by(AGENCY_ID) %>%\n  mutate(ResidentialParenting=length(AGENCY_ID))\nnew <- subset(new, !duplicated(AGENCY_ID))\nmerger <- cbind.data.frame(new$AGENCY_ID, new$ResidentialParenting)\ncolnames(merger) <- c(\"AGENCY_ID\", \"ResidentialParenting\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x=T)\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(ResidentialCenter=ResidentialCenter/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(FosterHome=FosterHome/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(NonRelative=NonRelative/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(GroupHome=GroupHome/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(RelativeCare=RelativeCare/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(DetentionFacility=DetentionFacility/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(LICENSEDMEF=LICENSEDMEF/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(AdoptivePlacement=AdoptivePlacement/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(EmergencyShelter=EmergencyShelter/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(IndependentLiving=IndependentLiving/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(OwnHome=OwnHome/length(AGENCY_ID))\n\ncomplete <- complete %>% group_by(AGENCY_ID) %>%\n  mutate(ResidentialParenting=ResidentialParenting/length(AGENCY_ID))\n\nnew <- subset(complete, !duplicated(CHILD_ID))\nnew <- new %>%\n  group_by(AGENCY_ID) %>%\n  mutate(AgencyPlacements = sum(number_placements))\n\nnew <- subset(new, !duplicated(AGENCY_ID))\nnew$AvgPlacements <- new$AgencyPlacements/new$KidsInAgency\n\nmerger <- cbind.data.frame(new$AGENCY_ID, new$AvgPlacements)\ncolnames(merger) <- c(\"AGENCY_ID\", \"AvgPlacements\")\n\ncomplete <- merge(complete, merger, by=\"AGENCY_ID\", all.x = T)\n\nsave(complete, df.5, file = \"updated.RData\")\nrm(list = ls())\nload(\"updated.RData\")\n\ncomplete$MinorityPercent <- complete$MinorityPercent.y\ncomplete$MinorityPercent.x <- complete$MinorityPercent.y <- NULL\ncomplete$AgencyAverageAge <- complete$AgencyAverageAge.y\ncomplete$AgencyAverageAge.x <- complete$AgencyAverageAge.y <- NULL\ncomplete$AgencyAverageLOS <- complete$AgencyAverageLOS.y\ncomplete$AgencyAverageLOS.x <- complete$AgencyAverageLOS.y <- NULL\ncomplete$AgencyFemalePercent <- complete$AgencyFemalePercent.y\ncomplete$AgencyFemalePercent.x <- complete$AgencyFemalePercent.y <- NULL\n\nsave(complete, df.5, file = \"updated.RData\")\nrm(list = ls())\nload(\"updated.RData\")\n\nAgencyLevel <- complete[!duplicated(complete$AGENCY_ID),]\n\nsave(AgencyLevel, file = \"AgencyLevel.RData\")\nload(\"AgencyLevel.RData\")\n\nAgencyLevel <- AgencyLevel[!is.na(AgencyLevel$AGENCY_NAME),]\n\nAgencyLevel <- subset(AgencyLevel, substr(AGENCY_NAME, nchar(AGENCY_NAME)-14, nchar(AGENCY_NAME)) != \" Juvenile Court\")\n\nsave(AgencyLevel, file = \"AgencyLevel.RData\")\n",
    "created" : 1449258588742.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "885285081",
    "id" : "8CAA3B33",
    "lastKnownWriteTime" : 1449260597,
    "path" : "C:/Users/Abdalah/Desktop/Git/CANS LoC/myPlayground.R",
    "project_path" : "myPlayground.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}